@using Microsoft.Extensions.Options
@using Microsoft.AspNetCore.Mvc.TagHelpers
@using HeroesCup.Web.ClubsModule.Controllers
@using HeroesCup.Web.ClubsModule.Models
@inject IConfiguration Configuration

@{
    ViewBag.Title = "Доброволческото състезание на училищата в България";

    var mainBodyClass = GetMainBodyClass();
    var schools = ViewBag.Schools;
    string GetMainBodyClass()
    {
        if (ViewBag.TypeId == "StartPage")
        {
            return "home-background";
        }

        if (ViewBag.TypeId == "ResourcesArchive")
        {
            return "resources-background";
        }

        if (ViewBag.TypeId == "EventsArchive")
        {
            return "events-background";
        }

        if (ViewBag.TypeId == "AboutPage")
        {
            return "about-background";
        }

        if (ViewBag.TypeId == "MissionsPage")
        {
            return "missions-background";
        }

        return string.Empty;
    }
}
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="HandheldFriendly" content="true">

    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400;600&display=auto" rel="stylesheet"/>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous"/>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css"/>
    <link rel="stylesheet" href="~/css/style.css"/>
    <link rel="stylesheet" href="~/css/custom-select.css"/>
    <script src="https://kit.fontawesome.com/e8be9fcdae.js" crossorigin="anonymous"></script>
    <partial name="Partial/_Favicons.cshtml"/>
    <script src="https://www.google.com/recaptcha/api.js?render=@Configuration.GetSection("GoogleRecaptcha").GetSection("SiteKey").Value"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-172912338-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-172912338-1');
    </script>

    <title>@ViewBag.Title</title>

    @if (Model is IMeta)
    {
        <partial name="Partial/_Meta.cshtml"/>
    }

    @RenderSection("head", false)
    <!-- Facebook Pixel Code -->
    <script>!function (f, b, e, v, n, t, s) { if (f.fbq) return; n = f.fbq = function () { n.callMethod ? n.callMethod.apply(n, arguments) : n.queue.push(arguments) }; if (!f._fbq) f._fbq = n; n.push = n; n.loaded = !0; n.version = '2.0'; n.queue = []; t = b.createElement(e); t.async = !0; t.src = v; s = b.getElementsByTagName(e)[0]; s.parentNode.insertBefore(t, s) }(window, document, 'script', 'https://connect.facebook.net/en_US/fbevents.js'); fbq('init', '286910919236893'); fbq('track', 'PageView');</script>
    <noscript>
        <img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=286910919236893&ev=PageView&noscript=1"/>
    </noscript><!-- End Facebook Pixel Code -->
</head>
<body class="@mainBodyClass modal-container">
<div class="modal fade justify-content-center" id="participateModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content p-md-4 p-2">
            <a href="/" type="button" class="close modal-close d-block d-md-block d-sm-none d-xs-none" data-dismiss="modal" aria-label="Close"></a>
            <div class="row modal-header">
                <div class="col-12">
                    <h2 class="heading2 modal-title d-none d-md-block d-sm-none d-xs-none">Участвай в Купата!</h2>
                    <san>Вече си регистриран? <a href="/manager">Влез в профила си</a></san>
                </div>
            </div>
            <div class="modal-body body2">
                <form name="participateForm" onsubmit="return onParticipateFormSubmit(event)">
                    <div class="row">
                        <div class="col">
                            <label for="participant-name">Име</label>
                            <div class="form-group">
                                <input class="form-control" name="participant-name" required id="participant-name" placeholder="Име" />
                            </div>
                        </div>
                        <div class="col">
                            <label for="participant-lastname">Фамилия</label>
                            <div class="form-group">
                                <input class="form-control" required id="participant-lastname" name="participant-lastname" placeholder="Фамилия" />
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label for="participant-type">Ти си</label>
                            <div class="form-group">
                                <select class="form-control" id="participant-type" name="participant-type">
                                    <option>Ученик</option>
                                    <option>Координатор</option>
                                </select>
                            </div>
                        </div>
                        <div class="col">
                            <label for="participant-school">Училище</label>
                            <div class="form-group">
                                <div class="form-group">
                                    <input class="form-control" name="participant-school" required id="participant-school" placeholder="Училище" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label for="participant-grade">Клас</label>
                            <div class="form-group">
                                <input class="form-control" id="participant-grade" name="participant-grade"  type="range" min="1" max="12" placeholder="Клас" list="grades"/>
                                <datalist id="grades">
                                    <option value="1" label="1"></option>
                                    <option value="2"></option>
                                    <option value="3"></option>
                                    <option value="4"></option>
                                    <option value="5"></option>
                                    <option value="6" label="6" ></option>
                                    <option value="7" selected="selected"></option>
                                    <option value="8"></option>
                                    <option value="9"></option>
                                    <option value="10"></option>
                                    <option value="11" label="11"></option>
                                    <option value="12" label="12"></option>
                                </datalist>
                                <input type="number" name="participateGradeOutput" disabled="disabled" value="7" style="max-width: 40px"/>
                            </div>
                            
                        </div>
                        <div class="col">
                            <label for="participant-location">Населено място</label>
                            <div class="form-group">
                                <input class="form-control" id="participant-location" name="participant-location" required placeholder="Населено място" />
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label for="participant-email">Email</label>
                            <div class="form-group">
                                <input class="form-control" id="participant-email" type="email"  name="participant-email" required placeholder="Email" />
                            </div>
                        </div>
                        <div class="col">
                            &nbsp;
                            
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label for="participant-more">Разкажи ни повече за себе си</label>
                            <div class="form-group">
                                <textarea class="form-control" id="participant-more" name="participant-more" required placeholder="Повече за теб" ></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <input type="checkbox" required="required"/> Съгласявам се с <a href="https://timeheroes.org/bg/pages/tocoop">Общите условия</a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <button class="btn btn-heroes btn-lg body2-bold" 
                                    data-sitekey="@Configuration.GetSection("GoogleRecaptcha").GetSection("SiteKey").Value" 
                                    id="submit-participate-form"
                            >Изпрати</button>
                        </div>
                    </div>
                    <input type="hidden" id="participate-g-token" name="participant-token"/>
                </form>
            </div>
        </div>
    </div>
</div>
<header class="site-header main-blur @(ViewBag.HasImage == null || !ViewBag.HasImage ? "site-header-dark" : "") justify-content-center">
    @if (ViewBag.TypeId != "LandingPage")
    {
        <div class="fixed-top">
            <div class="container mt-0 pl-0">
                <div class="row pl-0 pr-0">
                    <div class="col-md-12 col-sm-12 pl-0 pr-0">
                        <partial name="Partial/_Menu.cshtml"/>
                    </div>
                </div>
            </div>
        </div>
    }
</header>

@RenderBody()

<partial name="Partial/_Footer.cshtml"/>

<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
<script src="/scripts/navbar.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
<script>
        window.cookieconsent.initialise({
            "palette": {
                "popup": {
                    "background": "#000"
                },
                "button": {
                    "background": "#fe5e17",
                    "text": "#FFFFFF"
                }
            },
            "content": {
                "message": "\"Купата на героите\" от TimeHeroes ползва cookies, за да осигурим по-добро представяне на сайта и да подобрим Вашето преживяване. ",
                "dismiss": "Разбрах!",
                "link": "Научи повече",
                "href": "https://timeheroes.org/bg/pages/privacy"
            }
        });
    </script>
<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/bg_BG/sdk.js#xfbml=1&autoLogAppEvents=1&version=v7.0&appId=@Configuration["FacebookAppId"]"></script>
@RenderSection("script", false)
<script>
 document.participateForm["participant-grade"].oninput = function(){
    document.participateForm.participateGradeOutput.value = document.participateForm["participant-grade"].value;
 }
function onParticipateFormSubmit(e) {
  e.preventDefault();
  
  var siteKey = document.getElementById("submit-participate-form").getAttribute("data-siteKey");
  
  grecaptcha.ready(function() {
      grecaptcha.execute(siteKey, {action: 'submit'}).then(function(token) {
          $("#participate-g-token").val(token);
          var data = $(participateForm).serialize();
          $.ajax({
              type: 'POST',
              url: '/participate',
              contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
              data: data,
              success: function (result) {
                  $(participateForm)[0].reset();
                      $('#participateModal').modal('hide');
              },
              error: function (e) {
                  console.error(e);
              }
          })
      });
  });
}
$(".search-box, .search-box-result").on('submit',(e)=> {
        e.preventDefault();
        if (e.currentTarget.search.validity.valid) {
            grecaptcha.ready(function() {
                  const siteKey = e.currentTarget.getAttribute("data-siteKey");
                  grecaptcha.execute(siteKey, {action: 'submit'}).then(function(token) {
                      $(".search-token").each(function () {
                          $(this).val(token) 
                      });
                      $(e.currentTarget).unbind('submit').submit();
                      });    
                  });
            }
});
</script>
</body>
</html>